---
layout: post
title: "Ansible"
date: 2016-04-04 22:22:22
tags: [ansible, notes, 2017]
rating: 0
---
## Ansible:
#### Intro:
- ping/test all hosts in inventory file `ansible -m ping -i inventory.yaml all `
- you can define the default inventory file in your ~/.ansible.cfg or in the current folder ./ansible.cfg
<pre>[defaults]
hostfile = inventory.yaml
host_key_checking = False

- to run a command on a host defined in the inventory: `ansible -i inventory.yaml -m command -a uptime host_one `
    - the `-m command` part can be omitted as it's default
        - we can rewrite the command as `ansible -a uptime host_one`, as mentioned ansible.cfg defines the inventory file
        - the part after -m represents a _module_, so depending on the module being executed we can get different information returned
        	- `-m setup` can retrieve information about the host
        	- `-m ping` uses the _ping_ module to check if the host is reachable
    - add `-s` to sudo
- `yum: state=present name=git` in the playbook, will actually use the yum module
	- or _name={{our_package}}_ if in the **vars:** section we set _our_package: git_
	- `include: playbook.yaml our_package=nginx` because we can override the variable 
	- vars can be used as custom input fields, such as one-off/custom passwords
- handlers - a special task that can be executed if it is registered as a change
	- they don't run in the given order, but in the order they are notified
- playbooks will stop when encountering the first error, unless _ignore_errors: true_
	- debug can be enabled in tasks with _debug: var=my_output_
- first _shell:pwd_ then we define register as _register: pwd_output_, then we can use the variable as {{pwd_output['output']}}
	- we can filter the output/variable value by using either _failed_ or _success_ , e.g. {{variable_value|failed}}

#### First playbook:
<pre>- name: Configure nginx
  hosts: docker
  sudo: True
  tasks: 
  - name: install nginx
    apt: name=nginx
    [OR] shell: yum install -y nginx
    [OR] yum: state=present name=nginx
    [OR] service: state=started name=nginx


#### Docker:
- useful commands:
`docker pull <image_name>`
`docker image rm <hash>` - remove from disk given image/container
`docker ps` - list running containers
`docker images` - list available images locally
`docker run -d -p 2222:22 <image>` - start image, mapping ssh port, -d = detach or daemon :)
